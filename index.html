<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<style>
svg {
  height: 200px; // the contents will scale to fit because of viewBox
}
</style>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>amMap example</title>

        <link rel="stylesheet" href="../ammap/ammap.css" type="text/css">
        <script src="./ammap3/ammap/ammap.js" type="text/javascript"></script>
        <!-- map file should be included after ammap.js -->
		<script src="./ammap3/ammap/maps/js/worldLow.js" type="text/javascript"></script>
		<!--script src="../ammap/themes/black.js" type="text/javascript"></script-->
    <script src="./ammap3/ammap/themes/light.js" type="text/javascript"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/morgane_data.js" type="text/javascript"></script>
    <script src="./js/morgane_pie.js" type="text/javascript"></script>
    <script src="./js/pie.js"></script>
    <script src="./js/ammap_amcharts_extension.js"></script>
    <script src="./js/continentsLow.js"></script>
    <script src="./js/export.min.js"></script>
    <script src="./data.js"></script>
    <link rel="stylesheet" href="./js/export.css" type="text/css" media="all" />
            <script>
			/*
			        		although ammap has methos like getAreaCenterLatitude and getAreaCenterLongitude,
			        		they are not suitable in quite a lot of cases as the center of some countries
			        		is even outside the country itself (like US, because of Alaska and Hawaii)
			        		That's why wehave the coordinates stored here
			        	*/



			var map;

      var dataProvider = {
        mapVar: AmCharts.maps.worldLow,
        images: [],
        areas: []
      }



			AmCharts.theme = AmCharts.themes.light;
      AmCharts.hideCredits=true;

			// build map
			AmCharts.ready(function() {
				map = new AmCharts.AmMap();

				map.addTitle("UNCCD Action", 14);
				map.areasSettings = {
					unlistedAreasColor: "#FFFFFF",
					unlistedAreasAlpha: 0.1
				};
				map.imagesSettings = {
					balloonText: "<span style='font-size:14px;'><b>[[title]]</b>: [[value]]</span>",
					alpha: 0.6
				}

        /*for(var i = 0; i < 2; i++){
          for(var j = 0; j < 2; j++){
            for(var k = 0; k < 2; k++){
              for(var l = 0; l < 2; l++){
                for(var m = 0; m < 2; m++){
                  for(var n = 0; n < 2; n++){
                    var myItem= {
                      cat1: "",
                      cat2: "",
                      cat3: "",
                      cat4: "",
                      cat5: "",
                      cat6: ""
                    };
                    myItem.cat1=i.toString();
                    myItem.cat2=j.toString();
                    myItem.cat3=k.toString();
                    myItem.cat4=l.toString();
                    myItem.cat5=m.toString();
                    myItem.cat6=n.toString();
                    createPie(myItem);
                  }
                }
              }
            }
          }
        }
        return;*/




        for (var i = 0; i < morganeData.length; i++) {
          var dataItem = morganeData[i];
        	var itemTitle = morganeData[i].name;
          var id = dataItem.code;

          var filename = dataItem.cat1 + dataItem.cat2 + dataItem.cat3 + dataItem.cat4 + dataItem.cat5 + dataItem.cat6;
          //filename="000001";
          var img="./img/"+filename+".svg";
          //console.log("filename: " + img);
          var description="";
          if(dataItem.cat1 == "1") description+=" Drought Initiative,";
          if(dataItem.cat2 == "1") description+=" LDN Transformative projects,";
          if(dataItem.cat3 == "1") description+=" 3S,";
          if(dataItem.cat4 == "1") description+=" Greening Dryland Partnerships";
          if(dataItem.cat5 == "1") description+=" Gender,";
          if(dataItem.cat6 == "1") description+=" LDN Med,";


          dataProvider.images.push({
            title: itemTitle,
            balloonText: "[[title]]: [[description]]",
            description: description,
            longitude: latlong[id].longitude,
            latitude: latlong[id].latitude,
            imageURL: img,
            height: 20,
            width: 20,
            flag: "cat"
          });

        }

        dataProvider.images.push({
          id: "cat1",
          title: "Drought Initiative",
          left: 800,
          bottom: 15,
          type: "circle",
          color: COL_CAT1,
          width: 30,
          selectable: true,
          outlineColor: "white",
          outlineThickness: 0
        });

        dataProvider.images.push({
          id: "cat2",
          title: "LDN Transformative projects",
          left: 850,
          bottom: 15,
          type: "circle",
          color: COL_CAT2,
          width: 30,
          selectable: true,
          outlineColor: "white",
          outlineThickness: 0
        });

        dataProvider.images.push({
          id: "cat3",
          title: "3S",
          left: 900,
          bottom: 15,
          type: "circle",
          color: COL_CAT3,
          width: 30,
          selectable: true,
          outlineColor: "white",
          outlineThickness: 0
        });

        dataProvider.images.push({
          id: "cat4",
          title: "Greening Dryland Partnerships",
          left: 950,
          bottom: 15,
          type: "circle",
          color: COL_CAT4,
          width: 30,
          selectable: true,
          outlineColor: "white",
          outlineThickness: 0
        });

        dataProvider.images.push({
          id: "cat5",
          title: "Gender",
          left: 1000,
          bottom: 15,
          type: "circle",
          color: COL_CAT5,
          width: 30,
          selectable: true,
          outlineColor: "white",
          outlineThickness: 0
        });

        dataProvider.images.push({
          id: "cat6",
          title: "LDN Med",
          left: 1050,
          bottom: 15,
          type: "circle",
          color: COL_CAT6,
          width: 30,
          selectable: true,
          outlineColor: "white",
          outlineThickness: 0
        });





				map.dataProvider = dataProvider;

        //map.addListener("click", handleClick);
        map.addListener("clickMapObject", handleClick);
        map.addListener("zoomCompleted", updateCustomMarkers);

//        $("a[title='JavaScript charts']").remove();
				map.write("mapdiv");

			});

      var CAT1_CLICKED=false;
      var CAT2_CLICKED=false;
      var CAT3_CLICKED=false;
      var CAT4_CLICKED=false;
      var CAT5_CLICKED=false;
      var CAT6_CLICKED=false;


    function handleClick(event) {
         console.log(event);
         console.log("Id:" + event.mapObject.id);

         switch(event.mapObject.id){
          case "cat1":
            CAT1_CLICKED= !CAT1_CLICKED;
            console.log("CAT1_CLICKED:" + CAT1_CLICKED);
            break;
          case "cat2":
            CAT2_CLICKED= !CAT2_CLICKED;
            console.log("CAT1_CLICKED:" + CAT1_CLICKED);

            console.log("CAT2_CLICKED:" + CAT2_CLICKED);
            dataProvider.areas = [];
            break;

          case "cat3":
            console.log("cat3");
            CAT3_CLICKED= !CAT3_CLICKED;
            dataProvider.areas = [];
            break;

            case "cat4":
              console.log("cat4");
              CAT4_CLICKED= !CAT4_CLICKED;
              break;

              case "cat5":
                console.log("cat5");
                CAT5_CLICKED= !CAT5_CLICKED;
                break;

                case "cat6":
                  console.log("cat6");
                  CAT6_CLICKED= !CAT6_CLICKED;
                  break;
         }

         for (var x = 0; x < map.dataProvider.images.length; x++) {
           var image = map.dataProvider.images[x];
           console.log("image:" + image.id);
           if(image.type != "circle" ) continue;
           if(CAT1_CLICKED && (image.id == "cat1")){
             image.outlineThickness=5;
             console.log("set cat1 to 5");
           }else{
             if(image.id == "cat1"){
               console.log("set cat1 to 0");
               image.outlineThickness=0;
             }
           }
           if(CAT2_CLICKED && image.id == "cat2"){
             image.outlineThickness=5;
             console.log("set cat2 to 5");
           }else{
             if(image.id == "cat2"){
               console.log("set cat2 to 0");
               image.outlineThickness=0;
             }
           }
           if(CAT3_CLICKED && image.id == "cat3"){
             image.outlineThickness=5;
           }else{
             if(image.id == "cat3"){
               image.outlineThickness=0;
             }
           }
           if(CAT4_CLICKED && image.id == "cat4"){
             image.outlineThickness=5;
           }else{
             if(image.id == "cat4"){
               image.outlineThickness=0;
             }
           }
           if(CAT5_CLICKED && image.id == "cat5"){
               image.outlineThickness=5;

           }else{
             if(image.id == "cat5"){
               image.outlineThickness=0;
             }
           }
           if(CAT6_CLICKED && image.id == "cat6"){
             image.outlineThickness=5;
           }else{
             if(image.id == "cat6"){
               image.outlineThickness=0;
             }
           }
           //image.validate();

         }

         var color="white";
         var counter = 0;
         if(CAT1_CLICKED){
           counter ++; color=COL_CAT1;
         }
         if(CAT2_CLICKED){
           counter ++; color=COL_CAT2;
         }
         if(CAT3_CLICKED){
           counter ++; color=COL_CAT3;
         }
         if(CAT4_CLICKED){
           counter ++; color=COL_CAT4;
         }
         if(CAT5_CLICKED){
           counter ++; color=COL_CAT5;
         }
         if(CAT6_CLICKED){
           counter ++; color=COL_CAT6;
         }
         if(counter > 1) color="white";
         dataProvider.areas = [];
         console.log("counter: "+counter);
         console.log("color: "+color);
         if(counter > 0){
           for (var i = 0; i < morganeData.length; i++) {
             var dataItem = morganeData[i];
             if(((!CAT1_CLICKED) || (dataItem.cat1 > 0) )&&
                ((!CAT2_CLICKED) || (dataItem.cat2 > 0) )&&
                ((!CAT3_CLICKED) || (dataItem.cat3 > 0) )&&
                ((!CAT4_CLICKED) || (dataItem.cat4 > 0) )&&
                ((!CAT5_CLICKED) || (dataItem.cat5 > 0) )&&
                ((!CAT6_CLICKED) || (dataItem.cat6 > 0) )){
                  dataProvider.areas.push({
                    id: dataItem.code,
                    color: color
                  });
                }
              }
         }

         map.dataProvider = dataProvider;





         map.write("mapdiv");

      }



		</script>
    </head>
	<link rel="stylesheet" href="style.css" type="text/css">
    <body style="background-color:#222222;">
        <div id="mapdiv" style="width: 100%; height: 800px;"></div>
        <!--br>
        <div style="text-align:center; font-size:14px">
	        <a href="#" onclick="map.setProjection('winkel3')">Winkel 3</a> |
	        <a href="#" onclick="map.setProjection('eckert3')">Eckert 3</a> |
	        <a href="#" onclick="map.setProjection('eckert5')">Eckert 5</a> |
	        <a href="#" onclick="map.setProjection('eckert6')">Eckert 6</a> |
	        <a href="#" onclick="map.setProjection('miller')">Miller</a> |
	        <a href="#" onclick="map.setProjection('equirectangular')">Equirectangular</a> |
	        <a href="#" onclick="map.setProjection('mercator')">Mercator</a>
    	</div-->

    </body>

</html>
